<local:ActivatablePage x:Class="JitHubV3.Presentation.DashboardPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:JitHubV3.Presentation"
      xmlns:utu="using:Uno.Toolkit.UI"
      Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

  <local:ActivatablePage.Resources>
    <ResourceDictionary>
      <local:StringNullOrWhiteSpaceToVisibilityConverter x:Key="StringNullOrWhiteSpaceToVisibilityConverter" />

      <Style TargetType="ListViewItem">
        <Setter Property="MinHeight" Value="44" />
        <Setter Property="Padding" Value="{StaticResource DashboardRepoItemPadding}" />
        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
      </Style>
    </ResourceDictionary>
  </local:ActivatablePage.Resources>

  <ContentControl x:Name="StateHost"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch"
                  HorizontalContentAlignment="Stretch"
                  VerticalContentAlignment="Stretch">
    <VisualStateManager.VisualStateGroups>
      <VisualStateGroup x:Name="DashboardWidthStates">
        <VisualState x:Name="Narrow">
          <VisualState.Setters>
            <Setter Target="NavView.PaneDisplayMode" Value="LeftMinimal" />
            <Setter Target="NavView.IsPaneOpen" Value="False" />
          </VisualState.Setters>
        </VisualState>

        <VisualState x:Name="Wide">
          <VisualState.Setters>
            <Setter Target="NavView.PaneDisplayMode" Value="Left" />
            <Setter Target="NavView.IsPaneOpen" Value="True" />
          </VisualState.Setters>
        </VisualState>
      </VisualStateGroup>
    </VisualStateManager.VisualStateGroups>

        <Grid utu:SafeArea.Insets="VisibleBounds"
          HorizontalAlignment="Stretch"
          VerticalAlignment="Stretch">
      <NavigationView x:Name="NavView"
                      IsBackButtonVisible="Collapsed"
                      IsSettingsVisible="False"
                      PaneDisplayMode="LeftMinimal"
                      IsPaneOpen="False">

        <NavigationView.PaneHeader>
          <TextBlock Text="JitHub"
                     Margin="{StaticResource DashboardEdgePadding}" />
        </NavigationView.PaneHeader>

        <NavigationView.PaneCustomContent>
          <Grid>
            <ListView ItemsSource="{Binding Repositories}"
                      SelectedValuePath="Id"
                      SelectedValue="{Binding SelectedRepositoryId, Mode=TwoWay}"
                      SelectionMode="Single"
                      Margin="{StaticResource DashboardEdgePadding}"
                      AutomationProperties.Name="Repositories">
              <ListView.ItemTemplate>
                <DataTemplate>
                  <Border BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                          BorderThickness="0,0,0,1">
                    <StackPanel Spacing="{StaticResource DashboardSpacingXS}">
                      <TextBlock Text="{Binding Name}"
                                 TextTrimming="CharacterEllipsis"
                                 TextWrapping="NoWrap" />

                      <TextBlock Text="{Binding OwnerLogin}"
                                 Opacity="0.72"
                                 TextTrimming="CharacterEllipsis"
                                 TextWrapping="NoWrap" />

                      <TextBlock Text="{Binding Description}"
                                 Visibility="{Binding Description, Converter={StaticResource StringNullOrWhiteSpaceToVisibilityConverter}}"
                                 Opacity="0.72"
                                 TextWrapping="Wrap"
                                 TextTrimming="CharacterEllipsis"
                                 MaxLines="2" />
                    </StackPanel>
                  </Border>
                </DataTemplate>
              </ListView.ItemTemplate>
            </ListView>
          </Grid>
        </NavigationView.PaneCustomContent>

        <NavigationView.Content>
          <Grid Padding="{StaticResource DashboardContentPadding}">
            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    CornerRadius="{StaticResource DashboardRadiusM}"
                    Padding="{StaticResource DashboardEdgePadding}">
              <TextBlock Text="Center content placeholder"
                         TextWrapping="Wrap" />
            </Border>
          </Grid>
        </NavigationView.Content>
      </NavigationView>

      <!-- Compose box (ChatGPT-like; no-op for now). -->
      <Border x:Name="ComposeBox"
              VerticalAlignment="Bottom"
              HorizontalAlignment="Stretch"
              Margin="{StaticResource DashboardComposeMargin}"
              MaxWidth="{StaticResource DashboardComposeMaxWidth}"
              Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
              BorderThickness="1"
              CornerRadius="{StaticResource DashboardRadiusL}"
              Padding="{StaticResource DashboardComposePadding}">
        <Border.Shadow>
          <ThemeShadow />
        </Border.Shadow>

        <Grid ColumnSpacing="{StaticResource DashboardSpacingS}">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>

          <TextBox x:Name="ComposeInput"
                   Grid.Column="0"
                   AcceptsReturn="True"
                   TextWrapping="Wrap"
                   PlaceholderText="Ask anythingâ€¦"
                   HorizontalAlignment="Stretch"
                   VerticalAlignment="Stretch"
                   AutomationProperties.Name="Dashboard composer" />

          <Button Grid.Column="1"
                  IsEnabled="False"
                  VerticalAlignment="Bottom"
                  MinWidth="44"
                  MinHeight="44"
                  AutomationProperties.Name="Send (disabled)">
            <SymbolIcon Symbol="Send" />
          </Button>
        </Grid>
      </Border>
    </Grid>
  </ContentControl>
</local:ActivatablePage>
